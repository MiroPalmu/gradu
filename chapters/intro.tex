\chapter{Introduction}

\section{Plasma}

Plasma is quasi-neutral gas with enough free charges that the long range collective electromagnetic
interactions dominate over the interactions between induvidual particles
\cite{pert_foundations_2021,hazeltine_framework_2018}.
This can happen for example when a gas is heated enough such that the atoms get ionized.
Quasi-neutrality means that the gas is approximately neutral:
\begin{align}
  \rho = \sum_s n_s q_s \approx 0
\end{align}
where the sum is over all particle species, $n_s$ is particle density and $q_s$ is charge
of particle species $s$.

If a charge is introduced to a plasma in thermal equilibrium the free charges quickly screen
the resulting long range electric field away.
This is also known as Debye screening/shielding.
Phonomena gives rise to a length scale at which short range Coulomb interactions can happen.
The scale is characterized by Debye length $\lambda_D$ which is given by:
\begin{align}
  \label{eq:debye-length}
  \lambda_D^{-2} = \sum_s \frac{n_sq_s^2}{\epsilon_0 k_B T_s}
\end{align}
where $T_s$, $n_s$ and $q_s$ are temperature, number density and charge of particle species $s$,
$k_B$ is the Boltzmann constant and $\epsilon_0$ is the vacuum permittivity.

For plasma in a thermal equilibrium the scale of deviations from quasi-neutrality
over a length scale $L$ due to thermal fluctuations is
$\left(\frac{\lambda_D}{L}\right)^2$ \cite{wiesemann_short_2014,hazeltine_framework_2018}.
Thus we can formulate the quasi-neutrality condition of plasma over length scale $L$
as a requirement that the Debye length is much less than the scale $L$:
\begin{align}
  \lambda_D \ll L
\end{align}
However, for Debye length to be statistically valid there has to be enough particles inside
''Debye sphere'': $N_D = n \frac 43 \pi \lambda_D^3 \gg 1$.
Usually this requirement is expressed in terms of plasma parameter
which is defined up to a constant factor as $\Lambda = n\lambda_D^3$
and written as:
\begin{align}
  \label{eq:plasma-param-condition}
  \Lambda \gg 1
\end{align}

\section{Fundamental frequencies in plasma physics}

There are couple frequencies that appear often in plasma physics.
In plasma a small displacement of charges oscillates around the neutral configuration
at frequency which is called plasma frequency
\cite{wiesemann_short_2014,pert_foundations_2021,hazeltine_framework_2018}.
In a plasma the classical plasma frequency of particle species $s$ is given by:
\begin{align}
  \label{eq:classical-plasma-frequency}
  \omega_{ps}^2 = \frac{n_s q_s^2}{\epsilon_0 m_s}
\end{align}
We note for electron-ion systems the electron plasma frequency is much larger than
the ion plasma frequency and thus ion plasma oscillation can usually be neglected.

If magnetic field is present in a plasma the charges gyrorotate around the field lines
at the cyclotrone frequency. For particle species $s$ the cyclotrone frequency is given by:
\begin{align}
  \label{eq:cyclotron-frequency}
  \omega_B = \frac{q_sB}{m_sc\gamma}
\end{align}
where $B$ is magnitude of the magnetic field.
This motion is also kown as cyclotron motion.

\section{Kinetic plasma description}

As seen from the condition \eqref{eq:plasma-param-condition} the number of particles in plasma is large.
This makes modeling plasma using just particles and coulomb forces between them unfeasible.
In the kinetic plasma description the problem is solved by embracing the large number of particles
and describinig statistically their collective behavious.

For particle species $s$ the distribution function $f_s(\ve x, \ve p, t)$ describes
number of particles in a phase space region spanned by time interval $[t, t + dt]$,
location region $[\ve x , \ve x + d\ve x]$ and three-momentum region $[\ve p, \ve p + d\ve p]$
\cite{klimontovich_relativistic_1960,DeGroot:1980dk,hazeltine_framework_2018}.
The particles live on a mass-shell defined by Lorentz factor
$\gamma = \left(1-\frac{v^2}{c^2}\right)^{-1/2}$ where $v$ is the coordinate velocity
and $c$ is the speed of light.
We assume that the distribution function is normalized such that
\begin{align}
  \label{eq:number-density}
  \int f_s(\ve x, \ve p, t) d\ve p = n_s(\ve x, t)
\end{align}
where $n_s(\ve x, t)$ is the number density of particle species $s$.

Summing over all of the particle species we get the total charge density of plasma:
\begin{align}
  \label{eq:charge-density}
  \rho(\ve x, t) = \sum_s q_s n_s(\ve x, t)
\end{align}
Current density is given by:
\begin{align}
  \label{eq:current-density}
  \ve J(\ve x, t) = \int \sum_s q_s \ve v f_s(\ve x, \ve p, t) d\ve p
\end{align}
With these definitions of charge and current densities we can solve the self-consistent
electromagnetic fields from Maxwell's equations (in Gaussian CGS units):
\begin{align}
  \label{eq:maxwells}
  \nabla\times\ve E = -\frac1c \frac{\partial\ve B}{\partial t}, \qquad
  \nabla\times\ve B = \frac{4\pi}c \ve J + \frac1c \frac{\partial\ve E}{\partial t}, \qquad
  \nabla\cdot\ve E = 4\pi\rho, \qquad
  \nabla\cdot\ve B = 0
\end{align}

Evolution of the distribution function is governed by Boltzmann equation:
\begin{align}
  \label{eq:boltzmann}
  \partial_t f_s + \ve v \cdot \nabla f_s + \frac{d\ve p}{dt} \cdot \nabla_{\ve p} f_s
  = \left(\frac{\partial f_s}{\partial t}\right)_{\text{coll}}
\end{align}
where $\left(\frac{\partial f_s}{\partial t}\right)_{\text{coll}}$ is the collision term
which contains interactions between induvidual particles.
In case of plasmas $\frac{d\ve p}{dt}$ is given by the Lorentz force and
due to condition \eqref{eq:plasma-param-condition} applying
the short term collisions between the paritcles can be neglected and the collision term vanishes.
With the vanishing collision term the equation is called Vlasov equation:
\begin{align}
  \label{eq:vlasov}
  \partial_t f_\alpha
  + \mathbf{v} \cdot \nabla f_\alpha
  + q_\alpha ( \mathbf{E} + \boldsymbol{\beta} \times \mathbf{B}) \cdot \nabla_\mathbf{p} f_\alpha = 0
\end{align}
where we have defined vector $\boldsymbol{\beta} = \frac{\ve v}{c}$.
Maxwell's equations together with the Vlasov equation form Vlasov-Maxwell system.

\section{Cold-fluid limit}

Solving Vlasov-Maxwell system is difficult.
Fortunately in case of beam instabilities taking the cold-fluid limit of the system
makes it possible to investigate the beam instabilities analytically.
In order to do so, we have to calculate moments of the Vlasov equation.

Generally moment $M(\mathbf{p})$ of the Vlasov equation~\eqref{eq:vlasov} is:
\begin{align}
\int M \left(
\partial_t f_\alpha
+ \mathbf{v} \cdot \nabla f_\alpha
+ q_\alpha ( \mathbf{E} + \boldsymbol{\beta} \times \mathbf{B}) \cdot \nabla_\mathbf{p} f_\alpha
\right) d\mathbf{p} = 0
\end{align}
In the first two terms the derivatives can be trivially taken out of the integrant,
but the third requires some manipulation.

For brievity we'll define $a_\alpha^i = q_\alpha E^i + \frac{q_\alpha}{c}\epsilon^i_{lk}v^l B^k$.
Using the identity $ \partial_{p_i} v^l = \frac{\delta^l_i}{m \gamma} -  \frac{p^lp_i}{m^3c^2\gamma^3}$
we get that $\partial_{p_i}a_\alpha^i = 0$.
After integration by parts and noting
that physical distributions vanish at infinity, we can write the third term as:
\begin{align}
\int M \mathbf{a_\alpha} \cdot \nabla_\mathbf{p} f_\alpha d\mathbf{p}
&= - \int a^i \partial_{p_i} M f d\mathbf{p}
\end{align}
Overall we get that:
\begin{align}\label{eq:general-moment-of-vlasov}
  \partial_t \int M f_\alpha d\mathbf{p}
+ \partial_i \int M v^i f_\alpha d\mathbf{p}
= \int a^i \partial_{p_i} M f_\alpha d\mathbf{p}
\end{align}

A cold-fluid is characterized by a distribution function
$f(\mathbf{x}, \mathbf{p}, t) = n_\alpha(\ve x, t)\delta(\mathbf{p} - \mathbf{P}_\alpha(\mathbf{x}, t))$,
where $\mathbf{P}_\alpha(\mathbf{x}, t) = m_\alpha\gamma_\alpha\mathbf{V}_\alpha(\mathbf{x}, t)$
is calculated from the bulk velocity $\mathbf{V}_\alpha(\mathbf{x}, t)$ of the fluid
and $n_\alpha(\mathbf{x}, t)$ is its fuilds number density \cite{bret_multidimensional_2010,bret_collective_2004}.
Inserting this and $M = 1$ to \ref{eq:general-moment-of-vlasov} we obtain continuity equation
\cite{hazeltine_framework_2018}:
\begin{align}
\label{eq:continuity-in-cold-limit}
\partial_t n_\alpha + \nabla \cdot ( \ve V_\alpha n_\alpha ) = 0
\end{align}
For $M = \mathbf{p}$ and using the continuity equation we get:
\begin{align}
\label{eq:momentum-transport-in-cold-limit}
\partial_t \mathbf{P}_\alpha + (\mathbf{V}_\alpha \cdot \nabla) \mathbf{P}_\alpha
&= q_\alpha (\mathbf{E} + c^{-1}\mathbf{V}_\alpha \times \mathbf{B})
\end{align}


\section{Linearization of the cold-fluid limit}

Even in the cold-fluid limit solving for the general evolution of the system is difficult
and we have to settle for solving it perturbatively to some order and
in this theses the linear order solutions to equations \eqref{eq:continuity-in-cold-limit}
and \eqref{eq:momentum-transport-in-cold-limit} are sufficient.
Furthermore, we'll assume that the initial electromagnetic fields vanish\footnote{
  The analysis could be done with initial magnetic field for which
  $\ve V_0 \times \ve B_0 = 0$. However, this is unnecessary in context of this theses.
}.

Denoting equilibrium solutions with subscript $0$ and small perturbations with subscript $1$,
we can write (dropping particle species labels for brievity):
\begin{align}
  \label{eq:preturbed-variables}
  n &= n_0 + n_1 \\
  \ve V &= \ve V_0 + \ve V_1 \\
  \ve E &= \ve E_1 \\
  \ve B &= \ve B_1 \\
  \ve P &= m\gamma[\ve V_0 + \ve V_1](\ve V_0 + \ve V_1)
\end{align}
We'll use the Fourier representation for the perturbations,
i.e. $g_1 = \int \hat{g}_1 \exp(i(\ve k \cdot \ve x - \omega t))d\omega d^3k$.
Keeping only the linear order terms the expression for the momentum simplifies to
$\ve P = m\gamma\left(\ve V_0+\frac{\gamma^2}{c^2}(\ve V_0 \cdot \hat{\ve V}_1)\ve V_0 \right)$,
where we defined $\gamma = \gamma[\ve V_0]$.

Inserting these to \eqref{eq:continuity-in-cold-limit} and \eqref{eq:momentum-transport-in-cold-limit}
we get the linearized continuity equation and linearized momentum transport equation
\cite{bret_collective_2004,bret_cfa_2012}:
\begin{align}
  \label{eq:linearized-cold-fluid-continuity-eq}
  \hat{n}_1 &= \frac{n_0 \ve k \cdot \hat{\ve V}_1}{\omega - \ve k \cdot \ve V_0} \\
  \label{eq:linearized-cold-fluid-momentum-transport}
  im\gamma(\ve k \cdot \ve V_0 - \omega)
  (\hat{\ve V}_1 + \frac{\gamma^2}{c^2}(\ve V_0 \cdot \hat{\ve V}_1)\ve V_0)
  &= q(\hat{\ve E}_1 + \frac 1c \hat{\ve V}_1 \times \ve B_0 + \frac 1c \hat{\ve V}_0 \times \ve B_1)
\end{align}
Additionally we'll utilize linearity of Maxwell's equations \eqref{eq:maxwells}
and combine them to the linearized wave equation:
\begin{align}
  \label{eq:linearized-wave-eq}
  \ve k \times (\ve k \times \hat{\ve E}_1)
  + \frac{\omega^2}{c^2}\left(\hat{\ve E} _1 + \frac{4\pi i}{\omega}\hat{\ve J}_1\right) = 0
\end{align}
where $\hat{\ve J}_1$ in the cold-fluid limit is read from:
\begin{align}
  \ve J_1 &= \int \sum_s q_s(n_{s0}\hat{\ve V}_{s1} + n_{s1}\hat{\ve V}_{s0})
  \exp(i(\ve k \cdot \ve x - \omega t))d\omega d^3k \\
  &= \int \hat{\ve J}_1 \exp(i(\ve k \cdot \ve x - \omega t))d\omega d^3k
\end{align}

\section{Finite difference}
\label{sec:finite-difference}

PIC scheme requires solving Maxwells equations numerically on a discretized grid.
The most common way to discretize the derivatives is the centered finite-difference
which then leads to finite-difference time domain method which is discussed later (ref?).
Let the function $f(x)$ be discretized on a uniform grid of points $n h$
where $n \in \mathbb{N}$ and $h$ is the constant grid spacing.
For brevity we'll define notation $f_n = f(n h)$
and $f'_n = \left.\frac{df}{dx}\right\vert_{x=nh}$.

The second order accurate centered finite-difference discretizes the derivative as:
\begin{align}
  \label{eq:centered-fd}
  f'_n \approx \frac{f_{n + 1} - f_{n - 1}}{2h}
\end{align}

The second order accuracy of the algorithm is seen by Taylor expanding
the right-hand side of equation \eqref{eq:centered-fd}:
\begin{align}
  \frac{f_{n + 1} - f_{n - 1}}{2h}
  = \frac{1}{2h} \left(\sum_{k=0}^\infty \frac{h^k}{!k}f^{(k)}_n
  - \sum_{k=0}^\infty \frac{(-h)^k}{!k}f^{(k)}_n \right)
  = f'_n + O(h^2)
\end{align}
Centered second order derivative can be obtained by applying the centered first order derivative twice:
\begin{align}
  \label{eq:second-fd}
  f''_n \approx \frac{f'_{n + 1} - f'_{n - 1}}{2h} = \frac{f_{n+2} - 2 f_n + f_{n-2}}{4h^2}
\end{align}
Similarly to the first derivative we can see the second order accuracy from the Taylor expansion:
\begin{align}
  \label{eq:second-fd-accuracy}
  \frac{f_{n+2} - 2 f_n + f_{n-2}}{4h^2}  = f''_h + O(h^2)
\end{align}
We note that the central finite-difference second order derivative \eqref{eq:second-fd}
does not require the function values $f_{n+1}$ and $f_{n-1}$.
Thus it is usually defined on a finer grid with grid points at $\frac{nh}{2}$ where $n \in \mathbb{N}$.
This gives us the standard centered finite-difference second order derivative:
\begin{align}
  \label{eq:second-fd-correct}
  f''_n \approx \frac{f_{n+1} - 2 f_n + f_{n-1}}{h^2}
\end{align}
which is still second order accurate because the change only modifies
the constant coefficients in \eqref{eq:second-fd-accuracy}.

There exists higher order accurate schemes for calculating the centered finite-difference
but they are trade-off between higher numerical accuracy and computational cost.

\subsection{Numerical dispersion relation}

Stability of the centered finite-difference for the wave equation describes its accuracy
and stability properties. One dimensional wave equation reads:
\begin{align}
  \label{eq:one-d-wave-eq}
  \frac{\partial^2 \psi}{\partial t^2} = c^2 \frac{\partial^2 \psi}{\partial x^2}
\end{align}
Inserting the plane wave solution $\psi = e^{i(kx - \omega t)}$
to the wave equation~\eqref{eq:one-d-wave-eq} gives a physical dispresion relation:
\begin{align}
  \label{eq:one-d-wave-dispersion-eq}
  \omega = \pm ck
\end{align}

We'll discretize the function $\psi(x, t)$ on a uniform grid $(n \Delta x, m \Delta t)$
where $n,m\in\mathbb{N}$ and we'll denote $\psi^m_n = \psi(n\Delta x, m\Delta t)$.
Applying the centered finite-difference for second derivatives \eqref{eq:second-fd-correct}
to both temporal and spatial derivatives in the wave equation \eqref{eq:one-d-wave-eq}
and solving for $\psi_n^{m + 1}$ we'll get:
\begin{align}
  \label{eq:fd-intermediate}
  \psi_n^{m + 1} = \left(c\frac{\Delta t}{\Delta x}\right)^2
  (\psi_{n + 1}^m - 2\psi_n^m + \psi_{n-1}^m) + 2\psi_n^m - \psi_n^{m - 1}
\end{align}
Inserting plane wave $\psi_n^m = e^{i(k n \Delta x - \omega m \Delta t)}$
to \eqref{eq:fd-intermediate} results in the numerical dispersion relation
distictly different from the physical dispersion relation~\eqref{eq:one-d-wave-dispersion-eq}:
\begin{align}
  \label{eq:fd-dispersion}
  \frac{\omega}{c} \Delta x =
  \pm \frac{1}{\hat c}\cos^{-1}\left(\hat{c}^2 (\cos(k\Delta x) - 1) + 1\right)
\end{align}
where $\hat{c} \equiv c\frac{\Delta t}{\Delta x}$ is the Courant-Friedrichs-Lewy number
or the Courant number for short.
The solutions are periodic in $k$ with period of $\frac{2\pi}{\Delta x}$
which means that the finite-difference wave equation~\eqref{eq:fd-intermediate}
can not resolve waves past some wave number.

The numerical dispersion relation \eqref{eq:fd-dispersion}
reduces to the physical dispersion relation~\eqref{eq:one-d-wave-dispersion-eq}
when $\hat{c} = 1$ or when both $\Delta t$ and $\Delta x$ approach zero
but not when either one alone approaches zero.
These limits are summarized in the table \ref{fig:numerical-dispersion-relation-limits}.

\begin{table}
  \centering
  \begin{tabular}{|c|c|}
    \hline
    & \textbf{Equation \eqref{eq:fd-dispersion}} \\ \hline
    $\hat{c} = 1$ & $\omega = \pm ck$ \\ \hline
    $\Delta t \rightarrow 0$ & $\omega \Delta x = \pm c \sqrt{2(1-\cos(k\Delta x))}$ \\ \hline
    $\Delta x \rightarrow 0$ & $\cos(\omega \Delta t) = -c^2k^2\frac{(\Delta t)^2}{2} + 1$ \\ \hline
    $\Delta t \rightarrow 0$ and $\Delta x \rightarrow 0$ & $\omega = \pm ck$ \\ \hline
  \end{tabular}
  \caption{Summary of different limits for the numerical dispersion relation~\eqref{eq:fd-dispersion}.}
  \label{fig:numerical-dispersion-relation-limits}
\end{table}

The Courant number $\hat{c}$ has a great importance for the stability of solutions to
the finite-difference wave equation~\eqref{eq:fd-intermediate}.
For $\hat{c} > 1$ the numerical dispersion relation~\eqref{eq:fd-dispersion}
shows that $\omega$ has an positive imaginary part for some values of $k$
which results exponentially growing mode.
The condition for stablitiy $\hat c = c\frac{\Delta t}{\Delta x} \le 1$
is called the Courant-Friedrchs-Lewy condition.
In multiple dimensions the the criterior is given by~\cite{verboncoeur_particle_2005}:
\begin{align}
  \Delta t \le \frac{1}{c}\left( \sum_i \frac{1}{(\Delta x_i)^2} \right)^{-1/2}
\end{align}
The figure \ref{fig:cfl-plot} plots one period of
the numerical dispersion relation~\eqref{eq:fd-dispersion}.

\begin{figure}
  \centering
  \includegraphics{chapters/cfl-plot.pdf}
  \caption{Plots over one period of the numerical dispersion relation ~\eqref{eq:fd-dispersion}
    with different values for the Courant number $\hat c = \frac{c\Delta t}{\Delta x}$.
    The real parts of $\frac{\omega}{c}\frac{\Delta x}{\pi}$ are plotted as a continuous lines
    and the imaginary parts are plotted with dashed lines.
    The Courant number which fulfill the Courant-Friedrchs-Lewy condition are plotted
    with colors ranging from blue to green and which does not from red to yellow.
    The black plot represents the transition point at which $\hat c = 1$.
  }
  \label{fig:cfl-plot}
\end{figure}

%%% Local Variables:
%%% mode: LaTeX
%%% TeX-master: "../gradu"
%%% End:
